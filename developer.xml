<?xml version="1.0"?>
<project name="translate-developer" default="dist" basedir=".">

    <description>Developer targets
        
        This build file is used by the developers on  the Translate project.
        It contains the following major targets:
            
        dist       creates a complete distribution of the Translate framework.
                
    </description>
    
    <import file="build.xml"/>

    <property file="license.properties"/>

    <property name="dist.name" value="${package.name}-as1-${version}"/>

    <property name="dist.root.dir" location="dist"/>
    <property name="dist.dir" value="${dist.root.dir}/${dist.name}"/>

<!-- ***************************************
       Package the files for distribution.
     *************************************** --> 
    <target name="dist" depends="build,docs" description="Create a full distribution">
        
        <delete dir="${dist.dir}"/>
            
        <mkdir dir="${dist.dir}"/>
            
        <copy todir="${dist.dir}/src" overwrite="true">
            <fileset dir="${src.dir}">
                <include name="${package.dir}/*" />
                <include name="${package.dir}/doc-files/*" />
                <include name="${package.test.dir}/*" />
                <include name="${package.tool.dir}/*" />
            </fileset>
            <filterset>
                <filter token="license" value="${gpl.license}" />
            </filterset>
        </copy>

        <copy todir="${dist.dir}/lib" overwrite="true">
            <fileset dir="${lib.dir}">
                <include name="javacc.jar" />
                <include name="transform.jar" />
                <include name="testng-4.7-jdk14.jar" />
                <include name="testng-4.7-jdk15.jar" />
            </fileset>
        </copy>

        <copy todir="${dist.dir}/doc" overwrite="true">
            <fileset dir="doc"/>
        </copy>

        <copy todir="${dist.dir}/test" overwrite="true">
            <fileset dir="test">
                <include name="data/as1/*.as" />
                <include name="data/as1/*.swf" />
                <include name="data/as1/*.fla" />
                <include name="data/as1/script" />
                <include name="data/directives/*.as" />
                <include name="data/directives/script.txt" />
                <include name="suites/ASParserReference.xml" />
                <include name="suites/ASParser.xml" />
            </fileset>
        </copy>
        
        <copy todir="${dist.dir}" overwrite="true">
            <fileset dir=".">
                <include name="build.xml" />
                <include name="test.xml" />
                <include name="${package.name}.jar" />
             </fileset>
        </copy>

        <tar destfile="${dist.root.dir}/${dist.name}.tar.gz"
             basedir="${dist.dir}"
             compression="gzip"
        />
        
        <exec dir="${dist.root.dir}" executable="md5">
            <arg value="-n" />
            <arg value="-o${dist.name}.tar.md5" />
            <arg value="${dist.name}.tar.gz" />
        </exec>
        
        <zip destfile="${dist.root.dir}/${dist.name}.zip"
             basedir="${dist.dir}"
        />

        <exec dir="${dist.root.dir}" executable="md5">
            <arg value="-n" />
            <arg value="-o${dist.name}.zip.md5" />
            <arg value="${dist.name}.zip" />
        </exec>
        
        <echo file="${dist.root.dir}/${dist.name}-gpg.txt" append="false" 
            message="gpg --local-user support --armor --detach-sign --output ${dist.name}.tar.asc ${dist.name}.tar.gz${line.separator}"/>
        <echo file="${dist.root.dir}/${dist.name}-gpg.txt" append="true" 
            message="gpg --local-user support --armor --detach-sign --output ${dist.name}.zip.asc ${dist.name}.zip"/>
    </target>

</project>
