<?xml version="1.0"?>
<project name="translate" default="build" basedir=".">

    <description>ANT build file for Translate AS1.
    
        The following major targets are available:
        
        build      used to create a version of Transform that can be used in
	               production code. It compiles a clean, optimized version of 
                   the classes in the framework and packages them in a JAR.
                   The core classes in the framework  and any classes in the 
                   contrib directory are used, examples, tools and test classes 
                   are excluded.
        
        The following minor targets provide more control over the compiling 
        and packaging of classes, allowing for example a JAR file to be 
        created containing the framework classes and the examples.
        
        clean      remove all the files generated by the compile targets. This 
                   deletes the build directory which contains the compiled 
                   classes along with any JAR files created.
        
        grammar    regenerate the java classes from the ActionScript grammar. 

        classes    compile the classes.
         
        docs       generate javadoc datasheets for all the classes in the 
                   source tree.
                     
        jar        packages all of the compiled classes in the build directory
                   into the JAR file, translate.jar.

    </description>

    <property name="version" value="2.0.3"/>
    
    <property name="src.dir" location="src"/>
    <property name="lib.dir" location="lib"/>
    <property name="build.dir" location="build"/>
    
    <property name="package.name" value="translate"/>
    <property name="package.dir" value="com/flagstone/${package.name}"/>
    <property name="package.main.class" value="Translate.java"/>
    <property name="package.example.dir" value="${package.dir}/examples"/>
    <property name="package.tool.dir" value="${package.dir}/tools"/>
    <property name="package.test.dir" value="${package.dir}/test"/>
    
    <property name="doc.root.dir" location="doc"/>
    <property name="doc.release.dir" location="${doc.root.dir}/releases"/>
    <property name="doc.css.dir" value="${doc.root.dir}/css"/>
    <property name="doc.datasheet.dir" value="${doc.root.dir}/datasheets"/>
        
<!-- **********************************************************
         Major targets for compiling and packaging the classes.
     ********************************************************** -->
     
    <target name="build" depends="clean,grammar,classes,jar" 
        description="Compile optimized versions of the classes for deployment"/>

<!-- *******************************************************************
         Minor targets to compile and package different sets of classes.
     ******************************************************************* -->

    <target name="clean" description="Remove all the compiled classes">
        <delete dir="${build.dir}" failonerror="false"/>
        <delete file="${package.name}.jar" failonerror="false"/>
    </target>

    <target name="grammar" description="Regenerate the java classes from the grammar">
    
        <javacc
            target="${src.dir}/${package.dir}/ASParser.jj"
            outputdirectory="${src.dir}/${package.dir}"
            javacchome="${lib.dir}"
            static="false"
        />
        
    </target>

    <target name="classes" description="Compile the classes">
    
        <mkdir dir="${build.dir}"/>
        
        <replace dir="${src.dir}" token="DEBUG = true" value="DEBUG = false">
            <include name="${package.dir}/${package.main.class}"/>
        </replace>
                
        <javac srcdir="${src.dir}" destdir="${build.dir}" 
            debug="off" optimize="on" source="1.4">
            <include name="${package.dir}/*.java" />
        </javac>
        
    </target>

    <target name="tools" description="Compile the tools">
    
        <mkdir dir="${build.dir}"/>
        
        <javac srcdir="${src.dir}" destdir="${build.dir}" debug="on" optimize="off">
            <include name="${package.tool.dir}/*.java" />
        </javac>
        
    </target>

    <target name="docs" description="Generate javadoc datasheets for each class">
     
        <mkdir dir="${doc.datasheet.dir}"/>

        <javadoc destdir="${doc.datasheet.dir}" stylesheetfile="${doc.css.dir}/datasheet.css">
            <packageset dir="${src.dir}" defaultexcludes="yes">
                <include name="${package.dir}" />
            </packageset>
        </javadoc>

    </target>

    <target name="jar" description="Package all of the classes in a JAR file">
    
        <jar jarfile="${package.name}.jar">
            <fileset dir="${build.dir}">
                <include name="${package.dir}/**"/>
            </fileset>
        </jar>
        
    </target>

</project>
